<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StarPU Handbook: Debugging Tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">StarPU Handbook
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('DebuggingTools.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Debugging Tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>StarPU provides several tools to help debugging applications. Execution traces can be generated and displayed graphically, see <a class="el" href="OfflinePerformanceTools.html#GeneratingTracesWithFxT">Generating Traces With FxT</a>.</p>
<h1><a class="anchor" id="DebuggingInGeneral"></a>
TroubleShooting In General</h1>
<p>Generally-speaking, if you have troubles, pass <a class="el" href="CompilationConfiguration.html#enable-debug">--enable-debug</a> to <code>configure</code> to enable some checks which impact performance, but will catch common issues, possibly earlier than the actual problem you are observing, which may just be a consequence of a bug that happened earlier. Also, make sure not to have the <a class="el" href="CompilationConfiguration.html#enable-fast">--enable-fast</a> <code>configure</code> option which drops very useful catchup assertions. If your program is valgrind-safe, you can use it, see <a class="el" href="DebuggingTools.html#UsingOtherDebugger">Using Other Debugging Tools</a>.</p>
<p>Depending on your toolchain, it might happen that you get <code>undefined reference to `__stack_chk_guard'</code> errors. In that case, use the <code>&ndash;disable-fstack-protector-all</code> option to avoid the issue.</p>
<p>Then, if your program crashes with an assertion error, a segfault, etc. you can send us the result of</p>
<pre class="fragment">thread apply all bt
</pre><p>run in <code>gdb</code> at the point of the crash.</p>
<p>In case your program just hangs, but it may also be useful in case of a crash too, it helps to source <code>gdbinit</code> as described in the next section to be able to run and send us the output of the following commands:</p>
<pre class="fragment">starpu-workers
starpu-tasks
starpu-print-requests
starpu-print-prequests
starpu-print-frrequests
starpu-print-irrequests
</pre><p>To give us an idea of what is happening within StarPU. If the outputs are not too long, you can even run</p>
<pre class="fragment">starpu-all-tasks
starpu-print-all-tasks
starpu-print-datas-summary
starpu-print-datas
</pre><h1><a class="anchor" id="UsingGdb"></a>
Using The Gdb Debugger</h1>
<p>Some <code>gdb</code> helpers are provided to show the whole StarPU state:</p>
<pre class="fragment">(gdb) source tools/gdbinit
(gdb) help starpu
</pre><p>For instance, </p><ul>
<li>
one can print all tasks with <code>starpu-print-all-tasks</code>,  </li>
<li>
print all datas with <code>starpu-print-datas</code>,  </li>
<li>
print all pending data transfers with <code>starpu-print-prequests</code>, <code>starpu-print-requests</code>, <code>starpu-print-frequests</code>, <code>starpu-print-irequests</code>, </li>
<li>
print pending MPI requests with <code>starpu-mpi-print-detached-requests</code> </li>
</ul>
<p>Some functions can only work if <a class="el" href="CompilationConfiguration.html#enable-debug">--enable-debug</a> was passed to <code>configure</code> (because they impact performance)</p>
<h1><a class="anchor" id="UsingOtherDebugger"></a>
Using Other Debugging Tools</h1>
<p>Valgrind can be used on StarPU: valgrind.h just needs to be found at <code>configure</code> time, to tell valgrind about some known false positives and disable host memory pinning. Other known false positives can be suppressed by giving the suppression files in <code>tools/valgrind/*.suppr</code> to valgrind's <code>&ndash;suppressions</code> option.</p>
<p>The environment variable <a class="el" href="ExecutionConfigurationThroughEnvironmentVariables.html#STARPU_DISABLE_KERNELS">STARPU_DISABLE_KERNELS</a> can also be set to <code>1</code> to make StarPU does everything (schedule tasks, transfer memory, etc.) except actually calling the application-provided kernel functions, i.e. the computation will not happen. This permits to quickly check that the task scheme is working properly.</p>
<h1><a class="anchor" id="UsingTheTemanejoTaskDebugger"></a>
Using The Temanejo Task Debugger</h1>
<p>StarPU can connect to Temanejo &gt;= 1.0rc2 (see <a href="http://www.hlrs.de/temanejo">http://www.hlrs.de/temanejo</a>), to permit nice visual task debugging. To do so, build Temanejo's <code>libayudame.so</code>, install <code>Ayudame.h</code> to e.g. <code>/usr/local/include</code>, apply the <code>tools/patch-ayudame</code> to it to fix C build, re-<code>configure</code>, make sure that it found it, rebuild StarPU. Run the Temanejo GUI, give it the path to your application, any options you want to pass it, the path to <code>libayudame.so</code>.</p>
<p>It permits to visualize the task graph, add breakpoints, continue execution task-by-task, and run <code>gdb</code> on a given task, etc.</p>
<div class="image">
<img src="temanejo.png" alt="temanejo.png"/>
</div>
 <p>Make sure to specify at least the same number of CPUs in the dialog box as your machine has, otherwise an error will happen during execution. Future versions of Temanejo should be able to tell StarPU the number of CPUs to use.</p>
<p>Tag numbers have to be below <code>4000000000000000000ULL</code> to be usable for Temanejo (so as to distinguish them from tasks). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 22 2021 15:02:13 for StarPU Handbook by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
