<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StarPU Handbook: Interoperability Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">StarPU Handbook
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('InteroperabilitySupport.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Interoperability Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In situations where multiple parallel software elements have to coexist within the same application, uncoordinated accesses to computing units may lead such parallel software elements to collide and interfere. The purpose of the Interoperability routines of StarPU, implemented along the definition of the Resource Management APIs of Project H2020 INTERTWinE, is to enable StarPU to coexist with other parallel software elements without resulting in computing core oversubscription or undersubscription. These routines allow the programmer to dynamically control the computing resources allocated to StarPU, to add or remove processor cores and/or accelerator devices from the pool of resources used by StarPU's workers to execute tasks. They also allow multiple libraries and applicative codes using StarPU simultaneously to select distinct sets of resources independently. Internally, the Interoperability Support is built on top of Scheduling Contexts (see <a class="el" href="SchedulingContexts.html">Scheduling Contexts</a>).</p>
<h1><a class="anchor" id="ResourceManagement"></a>
StarPU Resource Management</h1>
<p>The <code>starpurm</code> module is a library built on top of the <code>starpu</code> library. It exposes a series of routines prefixed with <code>starpurm_</code> defining the resource management API.</p>
<p>All functions are defined in <a class="el" href="group__API__Interop__Support.html">Interoperability Support</a>.</p>
<h2><a class="anchor" id="Build"></a>
Linking a program with the starpurm module</h2>
<p>The <code>starpurm</code> module must be linked explicitly with the applicative executable using it. Example Makefiles in the <code>starpurm/dev/</code> subdirectories show how to do so. If the <code>pkg-config</code> command is available and the <code>PKG_CONFIG_PATH</code> environment variable is properly positioned, the proper settings may be obtained with the following <code>Makefile</code> snippet:</p>
<div class="fragment"><div class="line">CFLAGS += $(shell pkg-config --cflags starpurm-1.3)</div><div class="line">LDFLAGS+= $(shell pkg-config --libs-only-L starpurm-1.3)</div><div class="line">LDLIBS += $(shell pkg-config --libs-only-l starpurm-1.3)</div></div><!-- fragment --><h2><a class="anchor" id="InitExit"></a>
Initialization and Shutdown</h2>
<p>The <code>starpurm</code> module is initialized with a call to <a class="el" href="group__API__Interop__Support.html#ga2b9e909b240aefdbb79591bd42320f80">starpurm_initialize()</a> and must be finalized with a call to <a class="el" href="group__API__Interop__Support.html#ga5d75bda0b935dbaadd06bcaeda7381fe">starpurm_shutdown()</a>. The <code>starpurm</code> module supports CPU cores as well as devices. An integer ID is assigned to each supported device type. The ID assigned to a given device type can be queried with the <a class="el" href="group__API__Interop__Support.html#ga9b8e5d7f705f623d678509198ee635c4">starpurm_get_device_type_id()</a> routine, which currently expects one of the following strings as argument and returns the corresponding ID: </p><ul>
<li>
<code>"cpu"</code> </li>
<li>
<code>"opencl"</code> </li>
<li>
<code>"cuda"</code> </li>
<li>
<code>"mic"</code> </li>
</ul>
<p>The <code>cpu</code> pseudo device type is defined for convenience and designates CPU cores. The number of units of each type available for computation can be obtained with a call to starpu_get_nb_devices_by_type().</p>
<p>Each CPU core unit available for computation is designated by its rank among the StarPU CPU worker threads and by its own CPUSET bit. Each non-CPU device unit can be designated both by its rank number in the type, and by the CPUSET bit corresponding to its StarPU device worker thread. The CPUSET of a computing unit or its associated worker can be obtained from its type ID and rank with <a class="el" href="group__API__Interop__Support.html#ga9334160aa826c82711b67b06f1344796">starpurm_get_device_worker_cpuset()</a>, which returns the corresponding HWLOC CPUSET.</p>
<h2><a class="anchor" id="DefCTX"></a>
Default Context</h2>
<p>The <code>starpurm</code> module assumes a default, global context, manipulated through a series of routines allowing to assign and withdraw computing units from the main StarPU context. Assigning CPU cores can be done with <a class="el" href="group__API__Interop__Support.html#ga41a1343bdaf7c754bf103845b5f3592e">starpurm_assign_cpu_to_starpu()</a> and <a class="el" href="group__API__Interop__Support.html#ga0034db88f04b7a6fdb9dabf62aa4255e">starpurm_assign_cpu_mask_to_starpu()</a>, and assigning device units can be done with <a class="el" href="group__API__Interop__Support.html#ga6f6adfe90ef0bb6f1a17750fb5424304">starpurm_assign_device_to_starpu()</a> and <a class="el" href="group__API__Interop__Support.html#ga5e27d9d2e8395df0a6d2a880e41f7727">starpurm_assign_device_mask_to_starpu()</a>. Conversely, withdrawing CPU cores can be done with <a class="el" href="group__API__Interop__Support.html#gaaa53e570e6563d20aff14951063f526e">starpurm_withdraw_cpu_from_starpu()</a> and starpurm_withdraw_cpu_mask_from_starpu(=, and withdrawing device units can be done with <a class="el" href="group__API__Interop__Support.html#gaff4a7845c85eeec3152526984a813cf6">starpurm_withdraw_device_from_starpu()</a> and <a class="el" href="group__API__Interop__Support.html#ga1dd204e8e4728d2e13732b81d3387e13">starpurm_withdraw_device_mask_from_starpu()</a>. These routine should typically be used to control resource usage for the main applicative code.</p>
<h2><a class="anchor" id="TmpCTXS"></a>
Temporary Contexts</h2>
<p>Besides the default, global context, <code>starpurm</code> can create temporary contexts and launch the computation of kernels confined to these temporary contexts. The routine <a class="el" href="group__API__Interop__Support.html#gaec539f82e7bc8fc9c2541b4a192486fb">starpurm_spawn_kernel_on_cpus()</a> can be used to do so: it allocates a temporary context and spawns a kernel within this context. The temporary context is subsequently freed upon completion of the kernel. The temporary context is set as the default context for the kernel throughout its lifespan. This routine should typically be used to control resource usage for a parallel kernel handled by an external library built on StarPU. Internally, it relies on the use of <a class="el" href="group__API__Scheduling__Contexts.html#ga4e1aaf03ba327f47e5027c6fb7e5ed00">starpu_sched_ctx_set_context()</a> to set the temporary context as default context for the parallel kernel, and then restore the main context upon completion. Note: the maximum number of temporary contexts allocated concurrently at any time should not exceed <a class="el" href="group__API__Scheduling__Policy.html#gac45e8699959436b91bcf9b0c56a805df">STARPU_NMAX_SCHED_CTXS</a>-2, otherwise, the call to <a class="el" href="group__API__Interop__Support.html#gaec539f82e7bc8fc9c2541b4a192486fb">starpurm_spawn_kernel_on_cpus()</a> may block until a temporary context becomes available. The routine <a class="el" href="group__API__Interop__Support.html#gaec539f82e7bc8fc9c2541b4a192486fb">starpurm_spawn_kernel_on_cpus()</a> returns upon the completion of the parallel kernel. An asynchronous variant is available with the routine <a class="el" href="group__API__Interop__Support.html#gaaf29591aca9820e00a4a344175561ec0">starpurm_spawn_kernel_on_cpus_callback()</a>. This variant returns immediately, however it accepts a callback function, which is subsequently called to notify the calling code about the completion of the parallel kernel. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 22 2021 15:02:17 for StarPU Handbook by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
