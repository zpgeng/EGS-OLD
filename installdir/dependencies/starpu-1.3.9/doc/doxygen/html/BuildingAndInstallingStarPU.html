<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StarPU Handbook: Building and Installing StarPU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">StarPU Handbook
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('BuildingAndInstallingStarPU.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Building and Installing StarPU </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="InstallingABinaryPackage"></a>
Installing a Binary Package</h1>
<p>One of the StarPU developers being a Debian Developer, the packages are well integrated and very uptodate. To see which packages are available, simply type:</p>
<pre class="fragment">$ apt-cache search starpu
</pre><p>To install what you need, type for example:</p>
<pre class="fragment">$ sudo apt-get install libstarpu-1.3 libstarpu-dev
</pre><h1><a class="anchor" id="InstallingFromSource"></a>
Installing from Source</h1>
<p>StarPU can be built and installed by the standard means of the GNU autotools. The following chapter is intended to briefly remind how these tools can be used to install StarPU.</p>
<h2><a class="anchor" id="OptionalDependencies"></a>
Optional Dependencies</h2>
<p>The <code>hwloc</code> (<a href="http://www.open-mpi.org/software/hwloc">http://www.open-mpi.org/software/hwloc</a>) topology discovery library is not mandatory to use StarPU but strongly recommended. It allows for topology aware scheduling, which improves performance. <code>hwloc</code> is available in major free operating system distributions, and for most operating systems. Make sure to not only install a <code>hwloc</code> or <code>libhwloc</code> package, but also <code>hwloc-devel</code> or <code>libhwloc-dev</code> so as to have hwloc headers etc.</p>
<p>If <code>libhwloc</code> is installed in a standard location, no option is required, it will be detected automatically, otherwise <a class="el" href="CompilationConfiguration.html#with-hwloc">--with-hwloc=&lt;directory&gt;</a> should be used to specify its location.</p>
<p>If <code>libhwloc</code> is not available on your system, the option <a class="el" href="CompilationConfiguration.html#without-hwloc">--without-hwloc</a> should be explicitely given when calling the script <code>configure</code>.</p>
<h2><a class="anchor" id="GettingSources"></a>
Getting Sources</h2>
<p>StarPU's sources can be obtained from the download page of the StarPU website (<a href="https://starpu.gitlabpages.inria.fr/files/">https://starpu.gitlabpages.inria.fr/files/</a>).</p>
<p>All releases and the development tree of StarPU are freely available on StarPU SCM server under the LGPL license. Some releases are available under the BSD license.</p>
<p>The latest release can be downloaded from the StarPU download page (<a href="https://starpu.gitlabpages.inria.fr/files/">https://starpu.gitlabpages.inria.fr/files/</a>).</p>
<p>The latest nightly snapshot can be downloaded from the StarPU website (<a href="https://starpu.gitlabpages.inria.fr/files/testing/">https://starpu.gitlabpages.inria.fr/files/testing/</a>).</p>
<p>And finally, current development version is also accessible via git. It should only be used if you need the very latest changes (i.e. less than a day old!).</p>
<pre class="fragment">$ git clone git@gitlab.inria.fr:starpu/starpu.git
</pre><h2><a class="anchor" id="ConfiguringStarPU"></a>
Configuring StarPU</h2>
<p>Running <code>autogen.sh</code> is not necessary when using the tarball releases of StarPU. However when using the source code from the git repository, you first need to generate the script <code>configure</code> and the different Makefiles. This requires the availability of <code>autoconf</code> and <code>automake</code> &gt;= 2.60.</p>
<pre class="fragment">$ ./autogen.sh
</pre><p>You then need to configure StarPU. Details about options that are useful to give to <code>configure</code> are given in <a class="el" href="CompilationConfiguration.html">Compilation Configuration</a>.</p>
<pre class="fragment">$ ./configure
</pre><p>If <code>configure</code> does not detect some software or produces errors, please make sure to post the contents of the file <code>config.log</code> when reporting the issue.</p>
<p>By default, the files produced during the compilation are placed in the source directory. As the compilation generates a lot of files, it is advised to put them all in a separate directory. It is then easier to cleanup, and this allows to compile several configurations out of the same source tree. To do so, simply enter the directory where you want the compilation to produce its files, and invoke the script <code>configure</code> located in the StarPU source directory.</p>
<pre class="fragment">$ mkdir build
$ cd build
$ ../configure
</pre><p>By default, StarPU will be installed in <code>/usr/local/bin</code>, <code>/usr/local/lib</code>, etc. You can specify an installation prefix other than <code>/usr/local</code> using the option <code>&ndash;prefix</code>, for instance:</p>
<pre class="fragment">$ ../configure --prefix=$HOME/starpu
</pre><h2><a class="anchor" id="BuildingStarPU"></a>
Building StarPU</h2>
<pre class="fragment">$ make
</pre><p>Once everything is built, you may want to test the result. An extensive set of regression tests is provided with StarPU. Running the tests is done by calling <code>make check</code>. These tests are run every night and the result from the main profile is publicly available (<a href="https://starpu.gitlabpages/files/testing/master/">https://starpu.gitlabpages/files/testing/master/</a>).</p>
<pre class="fragment">$ make check
</pre><h2><a class="anchor" id="InstallingStarPU"></a>
Installing StarPU</h2>
<p>In order to install StarPU at the location which was specified during configuration:</p>
<pre class="fragment">$ make install
</pre><p>If you have let StarPU install in <code>/usr/local/</code>, you additionally need to run</p>
<pre class="fragment">$ sudo ldconfig
</pre><p>so the libraries can be found by the system.</p>
<p>Libtool interface versioning information are included in libraries names (<code>libstarpu-1.3.so</code>, <code>libstarpumpi-1.3.so</code> and <code>libstarpufft-1.3.so</code>).</p>
<h1><a class="anchor" id="SettingUpYourOwnCode"></a>
Setting up Your Own Code</h1>
<h2><a class="anchor" id="SettingFlagsForCompilingLinkingAndRunningApplications"></a>
Setting Flags for Compiling, Linking and Running Applications</h2>
<p>StarPU provides a <code>pkg-config</code> executable to obtain relevant compiler and linker flags. As compiling and linking an application against StarPU may require to use specific flags or libraries (for instance <code>CUDA</code> or <code>libspe2</code>).</p>
<p>If StarPU was not installed at some standard location, the path of StarPU's library must be specified in the environment variable <code>PKG_CONFIG_PATH</code> to allow <code>pkg-config</code> to find it. For example if StarPU was installed in <code>$STARPU_PATH</code>:</p>
<pre class="fragment">$ export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$STARPU_PATH/lib/pkgconfig
</pre><p>The flags required to compile or link against StarPU are then accessible with the following commands:</p>
<pre class="fragment">$ pkg-config --cflags starpu-1.3  # options for the compiler
$ pkg-config --libs starpu-1.3    # options for the linker
</pre><p>Note that it is still possible to use the API provided in the version 1.0 of StarPU by calling <code>pkg-config</code> with the <code>starpu-1.0</code> package. Similar packages are provided for <code>starpumpi-1.0</code> and <code>starpufft-1.0</code>. It is also possible to use the API provided in the version 0.9 of StarPU by calling <code>pkg-config</code> with the <code>libstarpu</code> package. Similar packages are provided for <code>libstarpumpi</code> and <code>libstarpufft</code>.</p>
<p>Make sure that <code>pkg-config &ndash;libs starpu-1.3</code> actually produces some output before going further: <code>PKG_CONFIG_PATH</code> has to point to the place where <code>starpu-1.3.pc</code> was installed during <code>make install</code>.</p>
<p>Also pass the option <code>&ndash;static</code> if the application is to be linked statically.</p>
<p>It is also necessary to set the environment variable <code>LD_LIBRARY_PATH</code> to locate dynamic libraries at runtime.</p>
<pre class="fragment">$ export LD_LIBRARY_PATH=$STARPU_PATH/lib:$LD_LIBRARY_PATH
</pre><p>And it is useful to get access to the StarPU tools:</p>
<pre class="fragment">$ export PATH=$PATH:$STARPU_PATH/bin
</pre><p>It is then useful to check that StarPU executes correctly and finds your hardware:</p>
<pre class="fragment">$ starpu_machine_display
</pre><p>If it does not, please check the output of <code>lstopo</code> from <code>hwloc</code> and report the issue to the <code>hwloc</code> project, since this is what StarPU uses to detect the hardware.</p>
<p><br />
 A tool is provided to help setting all the environment variables needed by StarPU. Once StarPU is installed in a specific directory, calling the script <code>bin/starpu_env</code> will set in your current environment the variables <code>STARPU_PATH</code>, <code>LD_LIBRARY_PATH</code>, <code>PKG_CONFIG_PATH</code>, <code>PATH</code> and <code>MANPATH</code>.</p>
<pre class="fragment">$ source $STARPU_PATH/bin/starpu_env
</pre><h2><a class="anchor" id="IntegratingStarPUInABuildSystem"></a>
Integrating StarPU in a Build System</h2>
<h3><a class="anchor" id="StarPUInMake"></a>
Integrating StarPU in a Make Build System</h3>
<p>When using a Makefile, the following lines can be added to set the options for the compiler and the linker:</p>
<pre class="fragment">CFLAGS          +=      $$(pkg-config --cflags starpu-1.3)
LDLIBS          +=      $$(pkg-config --libs starpu-1.3)
</pre><p>If you have a <code>test-starpu.c</code> file containing for instance:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="starpu_8h.html">starpu.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line">    ret = <a class="code" href="group__API__Initialization__and__Termination.html#ga9ce171bcbbee2edd169ba2649e6e75e3">starpu_init</a>(NULL);</div><div class="line">    <span class="keywordflow">if</span> (ret != 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    printf(<span class="stringliteral">&quot;%d CPU cores\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37da7fa269b896814504abcf227388233d1f">STARPU_CPU_WORKER</a>));</div><div class="line">    printf(<span class="stringliteral">&quot;%d CUDA GPUs\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37da26ced4e9dfc43343f0b442bb465218a9">STARPU_CUDA_WORKER</a>));</div><div class="line">    printf(<span class="stringliteral">&quot;%d OpenCL GPUs\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37dad2e8eb63bb5c17adcf205af07deff98c">STARPU_OPENCL_WORKER</a>));</div><div class="line">    <a class="code" href="group__API__Initialization__and__Termination.html#ga48edf5e30e71fbb71923e3867ad16c0a">starpu_shutdown</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>You can build it with <code>make test-starpu</code> and run it with <code>./test-starpu</code></p>
<h3><a class="anchor" id="StarPUInCMake"></a>
Integrating StarPU in a CMake Build System</h3>
<p>This section shows a minimal example integrating StarPU in an existing application's CMake build system.</p>
<p>Let's assume we want to build an executable from the following source code using CMake: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="starpu_8h.html">starpu.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line">    ret = <a class="code" href="group__API__Initialization__and__Termination.html#ga9ce171bcbbee2edd169ba2649e6e75e3">starpu_init</a>(NULL);</div><div class="line">    <span class="keywordflow">if</span> (ret != 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    printf(<span class="stringliteral">&quot;%d CPU cores\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37da7fa269b896814504abcf227388233d1f">STARPU_CPU_WORKER</a>));</div><div class="line">    printf(<span class="stringliteral">&quot;%d CUDA GPUs\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37da26ced4e9dfc43343f0b442bb465218a9">STARPU_CUDA_WORKER</a>));</div><div class="line">    printf(<span class="stringliteral">&quot;%d OpenCL GPUs\n&quot;</span>, <a class="code" href="group__API__Workers__Properties.html#ga60b4a796a3dba40e5159158750805bf2">starpu_worker_get_count_by_type</a>(<a class="code" href="group__API__Workers__Properties.html#gga173d616aefe98c33a47a847fd2fca37dad2e8eb63bb5c17adcf205af07deff98c">STARPU_OPENCL_WORKER</a>));</div><div class="line">    <a class="code" href="group__API__Initialization__and__Termination.html#ga48edf5e30e71fbb71923e3867ad16c0a">starpu_shutdown</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>The <code>CMakeLists.txt</code> file below uses the Pkg-Config support from CMake to autodetect the StarPU installation and library dependences (such as <code>libhwloc</code>) provided that the <code>PKG_CONFIG_PATH</code> variable is set, and is sufficient to build a statically-linked executable. This example has been successfully tested with CMake 3.2, though it may work with earlier CMake 3.x versions.</p>
<div class="fragment"><div class="line"> {File CMakeLists.txt}</div><div class="line">cmake_minimum_required (VERSION 3.2)</div><div class="line">project (hello_starpu)</div><div class="line"></div><div class="line">find_package(PkgConfig)</div><div class="line">pkg_check_modules(STARPU REQUIRED starpu-1.3)</div><div class="line">if (STARPU_FOUND)</div><div class="line">    include_directories (${STARPU_INCLUDE_DIRS})</div><div class="line">    link_directories    (${STARPU_STATIC_LIBRARY_DIRS})</div><div class="line">    link_libraries      (${STARPU_STATIC_LIBRARIES})</div><div class="line"><span class="keywordflow">else</span> (STARPU_FOUND)</div><div class="line">    message(FATAL_ERROR <span class="stringliteral">&quot;StarPU not found&quot;</span>)</div><div class="line">endif()</div><div class="line"></div><div class="line">add_executable(hello_starpu hello_starpu.c)</div></div><!-- fragment --><p>The following <code>CMakeLists.txt</code> implements an alternative, more complex strategy, still relying on Pkg-Config, but also taking into account additional flags. While more complete, this approach makes CMake's build types (Debug, Release, ...) unavailable because of the direct affectation to variable <code>CMAKE_C_FLAGS</code>. If both the full flags support and the build types support are needed, the <code>CMakeLists.txt</code> below may be altered to work with <code>CMAKE_C_FLAGS_RELEASE</code>, <code>CMAKE_C_FLAGS_DEBUG</code>, and others as needed. This example has been successfully tested with CMake 3.2, though it may work with earlier CMake 3.x versions.</p>
<div class="fragment"><div class="line"> {File CMakeLists.txt}</div><div class="line">cmake_minimum_required (VERSION 3.2)</div><div class="line">project (hello_starpu)</div><div class="line"></div><div class="line">find_package(PkgConfig)</div><div class="line">pkg_check_modules(STARPU REQUIRED starpu-1.3)</div><div class="line"></div><div class="line"><span class="preprocessor"># This section must appear before &#39;add_executable&#39;</span></div><div class="line"><span class="keywordflow">if</span> (STARPU_FOUND)</div><div class="line"><span class="preprocessor">    # CFLAGS other than -I</span></div><div class="line">    <span class="keywordflow">foreach</span>(CFLAG ${STARPU_CFLAGS_OTHER})</div><div class="line">        <span class="keyword">set</span> (CMAKE_C_FLAGS <span class="stringliteral">&quot;${CMAKE_C_FLAGS} ${CFLAG}&quot;</span>)</div><div class="line">    endforeach()</div><div class="line"></div><div class="line">    <span class="preprocessor"># Static LDFLAGS other than -L</span></div><div class="line">    <span class="keywordflow">foreach</span>(LDFLAG ${STARPU_STATIC_LDFLAGS_OTHER})</div><div class="line">        <span class="keyword">set</span> (CMAKE_EXE_LINKER_FLAGS <span class="stringliteral">&quot;${CMAKE_EXE_LINKER_FLAGS} ${LDFLAG}&quot;</span>)</div><div class="line">    endforeach()</div><div class="line"></div><div class="line">    <span class="preprocessor"># -L directories</span></div><div class="line">    link_directories(${STARPU_STATIC_LIBRARY_DIRS})</div><div class="line"><span class="keywordflow">else</span> (STARPU_FOUND)</div><div class="line">    message(FATAL_ERROR <span class="stringliteral">&quot;StarPU not found&quot;</span>)</div><div class="line">endif()</div><div class="line"></div><div class="line">add_executable(hello_starpu hello_starpu.c)</div><div class="line"></div><div class="line"><span class="preprocessor"># This section must appear after &#39;add_executable&#39;</span></div><div class="line"><span class="keywordflow">if</span> (STARPU_FOUND)</div><div class="line"><span class="preprocessor">    # -I directories</span></div><div class="line">    target_include_directories(hello_starpu PRIVATE ${STARPU_INCLUDE_DIRS})</div><div class="line"></div><div class="line">    # Static -l libs</div><div class="line">    target_link_libraries(hello_starpu PRIVATE ${STARPU_STATIC_LIBRARIES})</div><div class="line">endif()</div></div><!-- fragment --><h2><a class="anchor" id="RunningABasicStarPUApplication"></a>
Running a Basic StarPU Application</h2>
<p>Basic examples using StarPU are built in the directory <code>examples/basic_examples/</code> (and installed in <code>$STARPU_PATH/lib/starpu/examples/</code>). You can for example run the example <code>vector_scal</code>.</p>
<pre class="fragment">$ ./examples/basic_examples/vector_scal
BEFORE: First element was 1.000000
AFTER: First element is 3.140000
</pre><p>When StarPU is used for the first time, the directory <code>$STARPU_HOME/.starpu/</code> is created, performance models will be stored in this directory (<a class="el" href="ExecutionConfigurationThroughEnvironmentVariables.html#STARPU_HOME">STARPU_HOME</a>).</p>
<p>Please note that buses are benchmarked when StarPU is launched for the first time. This may take a few minutes, or less if <code>libhwloc</code> is installed. This step is done only once per user and per machine.</p>
<h2><a class="anchor" id="RunningABasicStarPUApplicationOnMicrosoft"></a>
Running a Basic StarPU Application on Microsoft Visual C</h2>
<p>Batch files are provided to run StarPU applications under Microsoft Visual C. They are installed in <code>$STARPU_PATH/bin/msvc</code>.</p>
<p>To execute a StarPU application, you first need to set the environment variable <a class="el" href="ExecutionConfigurationThroughEnvironmentVariables.html#STARPU_PATH">STARPU_PATH</a>.</p>
<pre class="fragment">c:\....&gt; cd c:\cygwin\home\ci\starpu\
c:\....&gt; set STARPU_PATH=c:\cygwin\home\ci\starpu\
c:\....&gt; cd bin\msvc
c:\....&gt; starpu_open.bat starpu_simple.c
</pre><p>The batch script will run Microsoft Visual C with a basic project file to run the given application.</p>
<p>The batch script <code>starpu_clean.bat</code> can be used to delete all compilation generated files.</p>
<p>The batch script <code>starpu_exec.bat</code> can be used to compile and execute a StarPU application from the command prompt.</p>
<pre class="fragment">c:\....&gt; cd c:\cygwin\home\ci\starpu\
c:\....&gt; set STARPU_PATH=c:\cygwin\home\ci\starpu\
c:\....&gt; cd bin\msvc
c:\....&gt; starpu_exec.bat ..\..\..\..\examples\basic_examples\hello_world.c
</pre><pre class="fragment">MSVC StarPU Execution
...
/out:hello_world.exe
...
Hello world (params = {1, 2.00000})
Callback function got argument 0000042
c:\....&gt;
</pre><h2><a class="anchor" id="KernelThreadsStartedByStarPU"></a>
Kernel Threads Started by StarPU</h2>
<p>StarPU automatically binds one thread per CPU core. It does not use SMT/hyperthreading because kernels are usually already optimized for using a full core, and using hyperthreading would make kernel calibration rather random.</p>
<p>Since driving GPUs is a CPU-consuming task, StarPU dedicates one core per GPU.</p>
<p>While StarPU tasks are executing, the application is not supposed to do computations in the threads it starts itself, tasks should be used instead.</p>
<p>If the application needs to reserve some cores for its own computations, it can do so with the field <a class="el" href="group__API__Initialization__and__Termination.html#a914081df89761428f6d9f4c8cb1754f3">starpu_conf::reserve_ncpus</a>, get the core IDs with <a class="el" href="group__API__Initialization__and__Termination.html#ga6acf1a3a588fe37d12af360aaf4f59dd">starpu_get_next_bindid()</a>, and bind to them with <a class="el" href="group__API__Initialization__and__Termination.html#gaf73f6097829e10aba1a9c22ee4c4e2e0">starpu_bind_thread_on()</a>.</p>
<p>Another option is for the application to pause StarPU by calling <a class="el" href="group__API__Initialization__and__Termination.html#ga887fbd250ba7843400b4438d617213d6">starpu_pause()</a>, then to perform its own computations, and then to resume StarPU by calling <a class="el" href="group__API__Initialization__and__Termination.html#gad1aff0c793b50e50f995232c110bde66">starpu_resume()</a> so that StarPU can execute tasks.</p>
<h2><a class="anchor" id="EnablingOpenCL"></a>
Enabling OpenCL</h2>
<p>When both CUDA and OpenCL drivers are enabled, StarPU will launch an OpenCL worker for NVIDIA GPUs only if CUDA is not already running on them. This design choice was necessary as OpenCL and CUDA can not run at the same time on the same NVIDIA GPU, as there is currently no interoperability between them.</p>
<p>To enable OpenCL, you need either to disable CUDA when configuring StarPU:</p>
<pre class="fragment">$ ./configure --disable-cuda
</pre><p>or when running applications:</p>
<pre class="fragment">$ STARPU_NCUDA=0 ./application
</pre><p>OpenCL will automatically be started on any device not yet used by CUDA. So on a machine running 4 GPUS, it is therefore possible to enable CUDA on 2 devices, and OpenCL on the 2 other devices by doing so:</p>
<pre class="fragment">$ STARPU_NCUDA=2 ./application
</pre><h1><a class="anchor" id="BenchmarkingStarPU"></a>
Benchmarking StarPU</h1>
<p>Some interesting benchmarks are installed among examples in <code>$STARPU_PATH/lib/starpu/examples/</code>. Make sure to try various schedulers, for instance <code>STARPU_SCHED=dmda</code>.</p>
<h2><a class="anchor" id="TaskSizeOverhead"></a>
Task Size Overhead</h2>
<p>This benchmark gives a glimpse into how long a task should be (in µs) for StarPU overhead to be low enough to keep efficiency. Running <code>tasks_size_overhead.sh</code> generates a plot of the speedup of tasks of various sizes, depending on the number of CPUs being used.</p>
<div class="image">
<img src="tasks_size_overhead.png" alt="tasks_size_overhead.png"/>
</div>
 <h2><a class="anchor" id="DataTransferLatency"></a>
Data Transfer Latency</h2>
<p><code>local_pingpong</code> performs a ping-pong between the first two CUDA nodes, and prints the measured latency.</p>
<h2><a class="anchor" id="MatrixMatrixMultiplication"></a>
Matrix-Matrix Multiplication</h2>
<p><code>sgemm</code> and <code>dgemm</code> perform a blocked matrix-matrix multiplication using BLAS and cuBLAS. They output the obtained GFlops.</p>
<h2><a class="anchor" id="CholeskyFactorization"></a>
Cholesky Factorization</h2>
<p><code>cholesky_*</code> perform a Cholesky factorization (single precision). They use different dependency primitives.</p>
<h2><a class="anchor" id="LUFactorization"></a>
LU Factorization</h2>
<p><code>lu_*</code> perform an LU factorization. They use different dependency primitives.</p>
<h2><a class="anchor" id="SimulatedBenchmarks"></a>
Simulated Benchmarks</h2>
<p>It can also be convenient to try simulated benchmarks, if you want to give a try at CPU-GPU scheduling without actually having a GPU at hand. This can be done by using the SimGrid version of StarPU: first install the SimGrid simulator from <a href="http://simgrid.gforge.inria.fr/">http://simgrid.gforge.inria.fr/</a> (we tested with SimGrid from 3.11 to 3.16, and 3.18 to 3.25. SimGrid versions 3.25 and above need to be configured with -Denable_msg=ON. Other versions may have compatibility issues, 3.17 notably does not build at all. MPI simulation does not work with version 3.22). Then configure StarPU with <a class="el" href="CompilationConfiguration.html#enable-simgrid">--enable-simgrid</a> and rebuild and install it, and then you can simulate the performance for a few virtualized systems shipped along StarPU: attila, mirage, idgraf, and sirocco.</p>
<p>For instance:</p>
<pre class="fragment">$ export STARPU_PERF_MODEL_DIR=$STARPU_PATH/share/starpu/perfmodels/sampling
$ export STARPU_HOSTNAME=attila
$ $STARPU_PATH/lib/starpu/examples/cholesky_implicit -size $((960*20)) -nblocks 20
</pre><p>Will show the performance of the cholesky factorization with the attila system. It will be interesting to try with different matrix sizes and schedulers.</p>
<p>Performance models are available for <code>cholesky_*</code>, <code>lu_*</code>, <code>*gemm</code>, with block sizes 320, 640, or 960 (plus 1440 for sirocco), and for <code>stencil</code> with block size 128x128x128, 192x192x192, and 256x256x256.</p>
<p>Read the chapter <a class="el" href="SimGridSupport.html">SimGrid Support</a> for more information on the SimGrid support. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Oct 22 2021 15:02:12 for StarPU Handbook by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
